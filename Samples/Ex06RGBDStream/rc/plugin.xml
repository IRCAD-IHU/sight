<plugin id="Ex06RGBDStream" version="@DASH_VERSION@">

    <requirement id="dataReg" />
    <requirement id="arDataReg" />
    <requirement id="scene2D" />
    <requirement id="servicesReg" />
    <requirement id="visuVTKQt" />
    <requirement id="visuVTKARAdaptor" />

    <extension implements="::fwServices::registry::AppConfig2">
        <id>Ex06RGBDStream</id>
        <config>

            <object uid="frameTLVideo" type="::arData::FrameTL" />
            <object uid="frameTLDepth" type="::arData::FrameTL" />

            <object uid="RGBDCameraSeries" type="::arData::CameraSeries" />

            <object uid="imageDepth" type="::fwData::Image" />
            <object uid="imageVideo" type="::fwData::Image" />

            <object uid="viewport" type="::fwRenderQt::data::Viewport" />

            <object uid="tfSelectionDepth" type="::fwData::Composite">
                <item key="SelectedTF">
                    <object uid="selectedTF" type="::fwData::TransferFunction">
                        <colors>
                            <step color="#000000ff" value="0" />
                            <step color="#ff0000ff" value="1" />
                            <step color="#ffff00ff" value="500" />
                            <step color="#00ff00ff" value="1000" />
                            <step color="#00ffffff" value="1500" />
                            <step color="#0000ffff" value="2000" />
                            <step color="#000000ff" value="5000" />
                        </colors>
                    </object>
                </item>
            </object>

            <!-- ***************************************** Begin layouts declaration ***************************************** -->

            <service uid="mainView" type="::gui::frame::SDefaultFrame">
                <gui>
                    <frame>
                        <name>Ex06RGBDStream</name>
                        <icon>@BUNDLE_PREFIX@/Ex06RGBDStream_@DASH_VERSION@/ex06rgbdstream.ico</icon>
                        <minSize width="800" height="600" />
                    </frame>
                    <toolBar />
                </gui>
                <registry>
                    <toolBar sid="toolbar" start="yes" />
                    <view sid="scanningView" start="yes" />
                </registry>
            </service>

            <service uid="toolbar" type="::gui::aspect::SDefaultToolBar">
                <gui>
                    <layout>
                        <editor />
                        <menuItem name="start" icon="@BUNDLE_PREFIX@/arMedia_0-1/icons/start-cam.svg" />
                        <menuItem name="stop" icon="@BUNDLE_PREFIX@/arMedia_0-1/icons/stop-cam.svg" />
                    </layout>
                </gui>
                <registry>
                    <menuItem sid="startVideo" start="yes" />
                    <menuItem sid="stopVideo" start="yes" />
                </registry>
            </service>

            <!-- Begin Scanning views -->
            <service uid="scanningView" type="::gui::view::SDefaultView">
                <gui>
                    <layout type="::fwGui::LineLayoutManager">
                        <orientation value="horizontal" />
                        <view proportion="30" />
                        <view proportion="70" />
                    </layout>
                </gui>
                <registry>
                    <view sid="TFView" start="yes" />
                    <view sid="RGBDView" start="yes" />
                </registry>
            </service>

            <service uid="TFView" type="::gui::view::SDefaultView">
                <gui>
                    <layout type="::fwGui::LineLayoutManager">
                        <orientation value="vertical" />
                        <view proportion="80" />
                        <view proportion="20" />
                    </layout>
                </gui>
                <registry>
                    <view sid="TFEditor" start="yes" />
                    <view sid="TFEditorSettings" start="yes" />
                </registry>
            </service>

            <service uid="RGBDView" type="::gui::view::SDefaultView">
                <gui>
                    <layout type="::fwGui::LineLayoutManager">
                        <orientation value="vertical" />
                        <view proportion="0" />
                        <view proportion="0" />
                    </layout>
                </gui>
                <registry>
                    <view sid="distanceMapRender" start="yes" />
                    <view sid="videoViewRender" start="yes" />
                </registry>
            </service>
            <!-- ***************************************** End layouts declaration ***************************************** -->

            <!-- ***************************************** Begin render scenes declarations ***************************************** -->

            <service uid="distanceMapRender" type="::fwRenderVTK::SRender" autoConnect="yes">
                <in key="imageDepth" uid="imageDepth" />
                <inout key="tfSelectionDepth" uid="tfSelectionDepth" />
                <scene>
                    <picker id="picker" vtkclass="fwVtkCellPicker" />
                    <renderer id="default" layer="0" background="0.0" />

                    <adaptor id="depthAdaptor" class="::visuVTKARAdaptor::SVideoAdapter" objectId="imageDepth">
                        <config renderer="default" selectedTFKey="SelectedTF" tfSelectionFwID="tfSelectionDepth" />
                    </adaptor>

                    <adaptor id="interactorStyle" class="::visuVTKAdaptor::InteractorStyle" objectId="self">
                        <config renderer="default" style="FixedInteractorStyle" />
                    </adaptor>
                </scene>
            </service>

            <service uid="videoViewRender" type="::fwRenderVTK::SRender" autoConnect="yes">
                <in key="imageVideo" uid="imageVideo" />
                <scene renderMode="timer">
                    <renderer id="default" layer="0" background="0.0" />

                    <adaptor id="videoAdaptor" class="::visuVTKARAdaptor::SVideoAdapter" objectId="imageVideo">
                        <config renderer="default" />
                    </adaptor>

                    <adaptor id="interactorStyle" class="::visuVTKAdaptor::InteractorStyle" objectId="self">
                        <config renderer="default" style="InteractorStyle2DForNegato" />
                    </adaptor>
                </scene>
            </service>

            <service uid="TFEditor" type="::fwRenderQt::SRender" >
                <scene>
                    <scene x="-10" y="-1.1" width="5500" height="1.2" antialiasing="true" />
                    <viewport x="0" y="-1.1" width="1200" height="1.2" />

                    <axis id="xAxis" origin="0.0" scale="1.0" scaleType="LINEAR" />
                    <axis id="yAxis" origin="0.0" scale="-1.0" scaleType="LINEAR" />

                    <adaptor uid="grid" />
                    <adaptor uid="abscissa" />
                    <adaptor uid="ordinate" />
                    <adaptor uid="maxOpacity" />
                    <adaptor uid="tf2" />
                    <adaptor uid="viewportRangeUpdater" />
                    <adaptor uid="scaleValuesLeft" />
                    <adaptor uid="axisLeft" />
                    <adaptor uid="scaleValuesBottom" />
                    <adaptor uid="axisBottom" />
                </scene>
            </service>
            <service uid="grid" type="::scene2D::adaptor::SGrid2D" >
                <config xMin="-10" xMax="5500" yMin="0.0" yMax="1.0" xSpacing="100" ySpacing="0.1"
                        opacity="0.25" color="darkGray" xAxis="xAxis" yAxis="yAxis" zValue="1" />
            </service>

            <service uid="abscissa" type="::scene2D::adaptor::SLine" >
                <config x1="-10" x2="5500" y1="0" y2="0" color="white" xAxis="xAxis" yAxis="yAxis" zValue="2" />
            </service>

            <service uid="ordinate" type="::scene2D::adaptor::SLine" >
                <config x1="0" x2="0" y1="-0.1" y2="1.2" color="white" xAxis="xAxis" yAxis="yAxis" zValue="3" />
            </service>

            <service uid="maxOpacity" type="::scene2D::adaptor::SLine" >
                <config x1="-1200" x2="1500" y1="1" y2="1" color="red" xAxis="xAxis" yAxis="yAxis" zValue="4" />
            </service>

            <service uid="tf2" type="::scene2D::adaptor::STransferFunction" autoConnect="yes">
                <inout key="image" uid="imageDepth" />
                <inout key="tfSelection" uid="tfSelectionDepth" />
                <inout key="viewport" uid="viewport" />
                <config lineColor="lightGray" circleColor="lightGray" xAxis="xAxis" yAxis="yAxis" zValue="7" selectedTFKey="SelectedTF" />
            </service>

            <service uid="viewportRangeUpdater" type="::scene2D::adaptor::SViewportUpdater" autoConnect="yes">
                <in key="viewport" uid="viewport" />
                <config xAxis="xAxis" yAxis="yAxis" zValue="9" />
            </service>

            <service uid="scaleValuesLeft" type="::scene2D::adaptor::SScaleValues" autoConnect="yes">
                <in key="viewport" uid="viewport" />
                <config min="0.0" max="1.0" interval="0.1" fontSize="7" align="left" unit="%" viewportUID="viewport" color="darkGray" xAxis="xAxis" yAxis="yAxis" zValue="11" />
            </service>

            <service uid="axisLeft" type="::scene2D::adaptor::SAxis" autoConnect="yes">
                <in key="viewport" uid="viewport" />
                <config min="0.0" max="1.0" interval="0.1" align="left" tickSize="5" viewportUID="viewport" color="darkGray" xAxis="xAxis" yAxis="yAxis" zValue="11" />
            </service>

            <service uid="scaleValuesBottom" type="::scene2D::adaptor::SScaleValues" autoConnect="yes">
                <in key="viewport" uid="viewport" />
                <config min="-1024" max="1024" interval="200" fontSize="7" align="bottom" viewportUID="viewport" color="darkGray" xAxis="xAxis" yAxis="yAxis" zValue="11" />
            </service>

            <service uid="axisBottom" type="::scene2D::adaptor::SAxis" autoConnect="yes">
                <in key="viewport" uid="viewport" />
                <config min="-1024" max="1024" interval="100" align="bottom" tickSize="5" viewportUID="viewport" color="darkGray" xAxis="xAxis" yAxis="yAxis" zValue="11" />
            </service>

            <service uid="TFEditorSettings" type="::fwRenderQt::SRender" autoConnect="yes">
                <scene>
                    <scene x="-10" y="-1.1" width="5100" height="1.2" />

                    <viewport x="-10" y="-1.1" width="5100" height="1.2" />

                    <axis id="xAxis" origin="0.0" scale="1.0" scaleType="LINEAR" />
                    <axis id="yAxis" origin="0.0" scale="-1.0" scaleType="LINEAR" />

                    <adaptor uid="shutterGrid" />
                    <adaptor uid="shutterAbscissa" />
                    <adaptor uid="shutterOrdinate" />
                    <adaptor uid="viewportRangeSelector" />
                </scene>
            </service>

            <service uid="shutterGrid" type="::scene2D::adaptor::SGrid2D" >
                <config xMin="-10" xMax="5100" yMin="-0.7" yMax="1.7" xSpacing="200" ySpacing="0.2" color="darkGray" xAxis="xAxis" yAxis="yAxis" zValue="1" />
            </service>

            <service uid="shutterAbscissa" type="::scene2D::adaptor::SLine" >
                <config x1="-10" x2="5100" y1="0" y2="0" color="white" xAxis="xAxis" yAxis="yAxis" zValue="2" />
            </service>

            <service uid="shutterOrdinate" type="::scene2D::adaptor::SLine" >
                <config x1="0" x2="0" y1="-0.1" y2="1.2" color="white" xAxis="xAxis" yAxis="yAxis" zValue="3" />
            </service>

            <service uid="viewportRangeSelector" type="::scene2D::adaptor::SViewportRangeSelector" autoConnect="yes">
                <inout key="viewport" uid="viewport" />
                <config xAxis="xAxis" yAxis="yAxis" zValue="5" initialWidth="1200" initialPos="0" />
            </service>

            <!-- ***************************************** End render scenes declaration ***************************************** -->

            <!-- ***************************************** Begin scanning services declarations ***************************************** -->

            <service uid="synchronizer" type="::videoTools::SFrameMatrixSynchronizer" worker="synchronizer">
                <in group="frameTL">
                    <key uid="frameTLVideo" />
                    <key uid="frameTLDepth" />
                </in>
                <inout group="image">
                    <key uid="imageVideo" />
                    <key uid="imageDepth" />
                </inout>
            </service>

            <!-- Manages Sense camera configuration -->
            <service uid="scanner" type="::videoOpenni::SScan" worker="scanWorker">
                <inout key="frameTLDepth" uid="frameTLDepth" />
                <inout key="frameTLColors" uid="frameTLVideo" />
                <inout key="cameraSeries" uid="RGBDCameraSeries" />
            </service>

            <!-- ***************************************** Begin mesh computing services declarations ***************************************** -->
            <service uid="startVideo" type="::gui::action::SSlotCaller">
                <slots>
                    <slot>startVideo/setInexecutable</slot>
                    <slot>scanner/startCamera</slot>
                    <slot>stopVideo/setExecutable</slot>
                </slots>
            </service>

            <service uid="stopVideo" type="::gui::action::SSlotCaller">
                <state executable="false" />
                <slots>
                    <slot>stopVideo/setInexecutable</slot>
                    <slot>scanner/stopCamera</slot>
                    <slot>startVideo/setExecutable</slot>
                </slots>
            </service>

            <!-- ***************************************** End connections declarations ***************************************** -->

            <!-- layouts -->
            <start uid="mainView" />

            <!-- reconstruction services -->
            <start uid="synchronizer" />
            <start uid="scanner" />

            <!-- TFEditor Scene2D -->
            <start uid="grid" />
            <start uid="abscissa" />
            <start uid="ordinate" />
            <start uid="maxOpacity" />
            <start uid="tf2" />
            <start uid="viewportRangeUpdater" />
            <start uid="scaleValuesLeft" />
            <start uid="axisLeft" />
            <start uid="scaleValuesBottom" />
            <start uid="axisBottom" />

            <!-- TFEditorSettings Scene2D -->
            <start uid="shutterGrid" />
            <start uid="shutterAbscissa" />
            <start uid="shutterOrdinate" />
            <start uid="viewportRangeSelector" />
        </config>
    </extension>

</plugin>
