<extension implements="::fwServices::registry::AppConfig">
    <id>calCameraView</id>
    <type>parameters</type>
    <parameters>
        <param name="WID_PARENT" />
        <param name="GENERIC_UID" />
        <param name="cameraUid" />
        <param name="timeLineUid" />
    </parameters>
    <config>

        <object type="::fwData::Composite">
            <service uid="${GENERIC_UID}_cameraView" type="::gui::view::IView" impl="::gui::view::DefaultView" autoConnect="no">
                <gui>
                    <layout type="::fwGui::CardinalLayoutManager">
                        <view align="center" />
                        <view align="bottom" />
                    </layout>
                    <toolBar />
                </gui>
                <registry>
                    <parent wid="${WID_PARENT}" />
                    <toolBar sid="${GENERIC_UID}_toolBar" start="yes" />
                    <view sid="${GENERIC_UID}_camera" start="yes" />
                    <view sid="${GENERIC_UID}_VideoSlider" start="yes" />
                </registry>
            </service>

            <service uid="${GENERIC_UID}_toolBar" type="::fwGui::IToolBarSrv" impl="::gui::aspect::DefaultToolBarSrv" autoConnect="no">
                <gui>
                    <layout>
                        <editor />
                        <menuItem name="Start camera" icon="Bundles/arMedia_0-1/icons/start-cam.svg" />
                        <menuItem name="Stop camera" icon="Bundles/arMedia_0-1/icons/stop-cam.svg" />
                        <menuItem name="Pause video" icon="Bundles/arMedia_0-1/icons/pause-cam.svg" />
                        <menuItem name="Loop video" icon="Bundles/arMedia_0-1/icons/loop-cam.svg" style="check" />
                    </layout>
                </gui>
                <registry>
                    <editor sid="${GENERIC_UID}_CameraSelector" start="yes" />
                    <menuItem sid="${GENERIC_UID}_ActionStartCamera" start="yes" />
                    <menuItem sid="${GENERIC_UID}_ActionStopCamera" start="yes" />
                    <menuItem sid="${GENERIC_UID}_PauseVideo" start="yes" />
                    <menuItem sid="${GENERIC_UID}_LoopVideo" start="yes" />
                </registry>
            </service>

            <service uid="${GENERIC_UID}_ActionStartCamera" impl="::gui::action::SSlotCaller" autoConnect="no">
                <slots>
                    <slot>${GENERIC_UID}_VideoGrabber/startCamera</slot>
                </slots>
            </service>

            <service uid="${GENERIC_UID}_ActionStopCamera" impl="::gui::action::SSlotCaller" autoConnect="no">
                <slots>
                    <slot>${GENERIC_UID}_VideoGrabber/stopCamera</slot>
                </slots>
            </service>

            <service uid="${GENERIC_UID}_PauseVideo" type="::fwGui::IActionSrv" impl="::gui::action::SSlotCaller" autoConnect="no">
                <slots>
                    <slot>${GENERIC_UID}_VideoGrabber/pauseCamera</slot>
                </slots>
            </service>

            <service uid="${GENERIC_UID}_LoopVideo" type="::fwGui::IActionSrv" impl="::gui::action::SSlotCaller" autoConnect="no">
                <slots>
                    <slot>${GENERIC_UID}_VideoGrabber/loopVideo</slot>
                </slots>
            </service>

           <service uid="${GENERIC_UID}_VideoSlider" impl="::videoQt::editor::SSlider" type="::gui::editor::IEditor" autoConnect="no"/>

            <service uid="${GENERIC_UID}_FrameUpdater" type="::fwServices::IController" impl="::videoTools::SFrameUpdater" autoConnect="no">
                <config>
                    <frameTLKey>frameTL</frameTLKey>
                    <imageKey>frame</imageKey>
                </config>
            </service>

            <service uid="${GENERIC_UID}_camera" impl="::fwRenderVTK::VtkRenderService" type="::fwRender::IRender" autoConnect="yes">
                <scene renderMode="timer">
                    <renderer id="default" background="0.0" />
                    <adaptor id="videoAdapter" class="::visuVTKARAdaptor::SVideoAdapter" objectId="frame">
                        <config renderer="default" />
                    </adaptor>
                    <adaptor id="interactorStyle" class="::visuVTKAdaptor::InteractorStyle" objectId="self">
                        <config renderer="default" style="InteractorStyle2DForNegato" />
                    </adaptor>
                </scene>
            </service>

            <item key="frameTL">
                <object uid="${timeLineUid}" type="::extData::FrameTL" src="ref">
                    <service uid="${GENERIC_UID}_VideoGrabber" impl="::videoQt::SFrameGrabber" autoConnect="no">
                        <cameraFwId>${cameraUid}</cameraFwId>
                    </service>
                </object>
            </item>

            <item key="frame">
                <object type="::fwData::Image" />
            </item>

            <item key="camera">
                <object uid="${cameraUid}" type="::arData::Camera" src="ref">
                    <service uid="${GENERIC_UID}_CameraSelector" impl="::videoQt::editor::SCamera" type="::gui::editor::IEditor" autoConnect="no">
                        <videoSupport>yes</videoSupport>
                    </service>
                </object>
            </item>

            <connect>
                <signal>${cameraUid}/idModified</signal>
                <slot>${GENERIC_UID}_VideoGrabber/stopCamera</slot>
            </connect>

            <connect>
                <signal>${GENERIC_UID}_VideoSlider/positionChanged</signal>
                <slot>${GENERIC_UID}_VideoGrabber/setPositionVideo</slot>
            </connect>
            <connect>
                <signal>${GENERIC_UID}_VideoGrabber/positionModified</signal>
                <slot>${GENERIC_UID}_VideoSlider/setPositionSlider</slot>
            </connect>
            <connect>
                <signal>${GENERIC_UID}_VideoGrabber/durationModified</signal>
                <slot>${GENERIC_UID}_VideoSlider/setDurationSlider</slot>
            </connect>

            <start uid="${GENERIC_UID}_cameraView" />
            <start uid="${GENERIC_UID}_VideoGrabber" />
            <start uid="${GENERIC_UID}_FrameUpdater" />

        </object>
    </config>
</extension>
