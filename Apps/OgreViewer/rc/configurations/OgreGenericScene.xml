<extension implements="::fwServices::registry::AppConfig2">
    <id>OgreGenericScene</id>
    <parameters>
        <param name="WID_PARENT" />
        <param name="modelSeriesUID" />
        <param name="genericSceneUID" />

        <!-- 3D negato image -->
        <param name="imageUID" />
        <param name="TFSelections" />
    </parameters>

    <config>

        <!-- ******************************* Objects declaration ****************************** -->

        <object uid="${modelSeriesUID}" type="::fwMedData::ModelSeries" src="ref" />

        <object uid="${imageUID}"  type="::fwData::Image" src="ref" />
        <object uid="${TFSelections}" type="::fwData::Composite" src="ref" />

        <object uid="frameTL" type="::extData::FrameTL" />
        <object uid="videoImage" type="::fwData::Image" />
        <object uid="camera" type="::arData::Camera" />

        <!-- ******************************* UI declaration *********************************** -->

        <service uid="OgreSceneView" type="::gui::view::SDefaultView" >
            <gui>
                <layout type="::fwGui::LineLayoutManager">
                    <orientation value="vertical" />
                    <view proportion="1" />
                    <view proportion="0" />
                </layout>
                <toolBar/>
            </gui>
            <registry>
                <parent wid="${WID_PARENT}" />
                <toolBar sid="toolBar" start="yes" />
                <view sid="${genericSceneUID}" start="yes" />
                <view sid="negato3DInteractor" start="yes" />
            </registry>
        </service>

        <service uid="toolBar" type="::gui::aspect::SDefaultToolBar" >
            <gui>
                <layout>
                    <menuItem name="Show/Hide negato interactor" icon="@BUNDLE_PREFIX@/OgreViewer_0-1/icons/hide-view_horizontal.png" style="check" />
                    <separator />
                    <editor />
                    <menuItem name="Play" icon="@BUNDLE_PREFIX@/arMedia_0-1/icons/start-cam.svg"/>
                    <menuItem name="Pause" icon="@BUNDLE_PREFIX@/arMedia_0-1/icons/pause-cam.svg"/>
                    <menuItem name="Stop" icon="@BUNDLE_PREFIX@/arMedia_0-1/icons/stop-cam.svg"/>

                </layout>
            </gui>
            <registry>
                <menuItem sid="action_negato3DInteractor" start="yes" />
                <editor sid="videoSelector" start="yes" />
                <menuItem sid="action_startVideo" start="yes" />
                <menuItem sid="action_pauseVideo" start="yes" />
                <menuItem sid="action_stopVideo" start="yes" />
            </registry>
        </service>

        <service uid="negato3DInteractor" type="::gui::view::SDefaultView" >
            <gui>
                <layout type="::fwGui::LineLayoutManager" >
                    <orientation value="vertical" />
                    <view proportion="1" />
                    <view proportion="1" />
                    <view proportion="1" />
                </layout>
            </gui>
            <registry>
                <view sid="sliderIndexEditor3D" start="yes" />
                <view sid="windowLevel3D" start="yes" />
                <view sid="transparencyEditor" start="yes" />
            </registry>
        </service>

        <!-- ******************************* Actions ****************************************** -->

        <service uid="action_negato3DInteractor" type="::gui::action::SModifyLayout" >
            <config>
                <show_or_hide sid="negato3DInteractor" />
            </config>
        </service>

        <service uid="action_startVideo" type="::gui::action::SSlotCaller">
            <slots>
                <slot>frameGrabber/startCamera</slot>
            </slots>
        </service>

        <service uid="action_pauseVideo" type="::gui::action::SSlotCaller">
            <slots>
                <slot>frameGrabber/pauseCamera</slot>
            </slots>
        </service>

        <service uid="action_stopVideo" type="::gui::action::SSlotCaller">
            <slots>
                <slot>frameGrabber/stopCamera</slot>
            </slots>
        </service>

        <!-- ******************************* Services ***************************************** -->

        <service uid="${genericSceneUID}" type="::fwRenderOgre::SRender" autoConnect="yes" >
            <in key="modelSeries" uid="${modelSeriesUID}" />
            <in key="videoImage" uid="videoImage" />
            <in key="image" uid="${imageUID}" />
            <in key="camera" uid="camera" />
            <inout key="TFSelections" uid="${TFSelections}" />

            <scene overlay="true" >
                <background topColor="#DDDDDD" bottomColor="#43958D" topScale="0.7" bottomScale="1.0" />
                <renderer id="video" layer="1" />
                <!-- Default Layer -->
                <renderer id="default" layer="2" />

                <adaptor id="videoAdapter" class="::visuOgreAdaptor::SVideo" objectId="videoImage">
                    <config renderer="video" cameraUID="camera" />
                </adaptor>

                <adaptor id="interactorAdaptorVideo" class="::visuOgreAdaptor::SInteractorStyle" objectId="self">
                    <config renderer="video" style="Fixed" />
                </adaptor>

                <adaptor id="interactorAdaptor" class="::visuOgreAdaptor::SInteractorStyle" objectId="self">
                    <config renderer="default" style="Trackball" />
                </adaptor>

                <adaptor id="modelSeriesAdaptor" class="::visuOgreAdaptor::SModelSeries" objectId="modelSeries">
                    <config renderer="default" />
                </adaptor>

                <adaptor id="negato3DAdaptor" class="::visuOgreAdaptor::SNegato3D" objectId="image">
                     <config renderer="default" selectedTFKey="SelectedTF" tfSelectionFwID="TFSelections" />
                </adaptor>

            </scene>
        </service>

        <service uid="synchronizer" type="::videoTools::SFrameMatrixSynchronizer" worker="videoWorker">
            <in group="frameTL">
                <key uid="frameTL" />
            </in>
            <inout group="image">
                <key uid="videoImage" />
            </inout>
            <framerate>30</framerate>
        </service>

        <service uid="sliderIndexEditor3D" type="::uiImage::SliceIndexPositionEditor" autoConnect="yes">
            <inout key="imageKey" uid="${imageUID}" />
            <sliceIndex>Sagittal</sliceIndex>
        </service>

        <!-- Negato windowing service -->
        <service uid="windowLevel3D" type="::uiImage::WindowLevel" autoConnect="yes">
            <inout key="image" uid="${imageUID}" autoConnect="yes" />
            <inout key="TFSelections" uid="${TFSelections}" />
            <config selectedTFKey="SelectedTF" />
        </service>

        <service uid="transparencyEditor" type="::uiImage::ImageTransparency" autoConnect="yes" >
            <inout key="image" uid="${imageUID}" />
        </service>

       <service uid="frameGrabber" type="::videoQt::SFrameGrabber" >
           <in key="camera" uid="camera" />
           <inout key="frameTL" uid="frameTL" />
       </service>

        <service uid="videoSelector" type="::videoQt::editor::SCamera" >
            <inout key="camera" uid="camera"/>
            <videoSupport>yes</videoSupport>
        </service>

        <start uid="OgreSceneView" />
        <start uid="frameGrabber" />
        <start uid="synchronizer" />
        <update uid="action_negato3DInteractor" />

    </config>
</extension>
